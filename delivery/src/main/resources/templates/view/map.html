<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link href="/css/map.css" rel="stylesheet">
</head>
<body>
 	<form id="addressForm">
		 <input type="text" id="address" readonly="readonly" placeholder="지번, 도로명, 건물명으로 검색">
		 <input type="text" id="detail" placeholder="상세주소 입력">
		 <button type="button" onclick="save()">저장</button>
 	</form>
 	<ul>
 		<li th:each="address : ${address}"> <!-- ${여기가 controller에서 가져온 애} -->
 			<span th:text="${address.address}"></span>
 	</ul>
 
</body>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
 <script type="text/javascript">
	 $("#address").click(function() {
	     new daum.Postcode({
	         oncomplete: function(data){ 
	             $("#address").val(data.address);
	         },
	         // 팝업창의 크기와 위치 설정
	         width: 500,  // 팝업창의 너비
	         height: 600,  // 팝업창의 높이
	         popupName: 'postcodePopup'  // 팝업창의 이름
	     }).open({
	         left: (window.screen.width / 2) - 250,  // 화면의 중앙에 위치하도록 설정
	         top: (window.screen.height / 2) - 300
	     });
	 });
	 
	 function save() {
		 const address = $('#address').val();
		 const data = { address : address };
		 
		 $.ajax({
			 url: '/address',
			 type: 'post',
			 contentType: 'application/json',
			 data: JSON.stringify(data),
			 success: function(response) {
		            if (response.redirectUrl) {
		                window.location.href = response.redirectUrl; // 성공하면 index로 리디렉션
		            }
		        },
		        error: function(xhr, status, error) {
		            console.error('Error:', error); // 오류가 발생하면 콘솔에 출력
		        }
		 });
	 }
	 
	 $('#addressForm').submit(function(eveint) {
		 event.preventDefault(); //기본 동작 막기
		 save(); //ajax 요청 수행
	 })
 </script>
</html>